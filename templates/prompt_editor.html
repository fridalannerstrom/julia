{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Julia</title>

    <!-- Bootstrap CSS (samma som p√• verktygssidan) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Din egna styles -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" href="{% static 'img/favicon.ico' %}">
</head>

<body id="page-top">
  <div class="app-shell">

    <!-- SIDEBAR (samma som p√• verktygssidan, men med aktiv l√§nk p√• √Ñndra prompts) -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <span class="brand-dot"></span>
        <span class="brand-text">Julia AI</span>
      </div>

      <nav class="sidebar-nav">
        <a href="{% url 'index' %}" class="sidebar-link">
          <span class="sidebar-icon">‚öôÔ∏è</span>
          <span>Verktyget</span>
        </a>
        <a href="{% url 'prompt_editor' %}" class="sidebar-link sidebar-link-active">
          <span class="sidebar-icon">üìù</span>
          <span>√Ñndra prompts</span>
        </a>
        <a href="{% url 'chat_home' %}" class="sidebar-link">
          <span class="sidebar-icon">üí¨</span>
          <span>Chatt</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-chip">
          <div class="user-avatar">
            {{ user.first_name|default:"J" |first }}
          </div>
          <div class="user-meta">
            <span>Inloggad som</span>
            <strong>{{ user.get_full_name|default:"G√§st" }}</strong>
          </div>
        </div>
        <button class="logout-btn" type="button">
          Logga ut
        </button>
        <p class="sidebar-copy">¬© TQ Nordic</p>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-area">
      <header class="page-header">
        <div>
          <h1>Hej {{ user.first_name|default:user.username }} üëã</h1>
          <p>Uppdatera AI-instruktioner f√∂r Domarn√§mnden.</p>
        </div>
        <div class="page-header-meta">
          <span class="pill">Domarn√§mnden</span>
          <span class="pill pill-soft">Prompts</span>
        </div>
      </header>

      <section id="about">
        <div class="adminui-layout">
          <div class="adminui-main">
            <div class="adminui-container">

              <h2 class="adminui-title" style="margin-top:0;">Redigera AI-instruktioner</h2>
              <p class="adminui-intro">
                H√§r styr du hur Julia AI tolkar testresultat, intervjuanteckningar och hur
                rapportens olika delar formuleras. Uppdelat i tre tydliga sektioner.
              </p>

              <div class="adminui-assessment-box" style="font-size:0.9rem; margin-bottom:24px;">
                <b>Tillg√§ngliga taggar:</b><br>
                <code>{excel_text}</code> ‚Äì r√•data/utdrag fr√•n Excelfilen (anv√§nd helst inte denna)<br>
                <code>{intervju_text}</code> ‚Äì intervjuanteckningar (rensade/samlade).<br>
                <code>{ratings_json}</code> ‚Äì Alla betyg 1‚Äì5 fr√•n testet (rensade/samlade).<br>
                <code>{betygsskala_forklaring}</code> ‚Äì din definition av vad niv√•erna betyder.<br><br>

                <code>{tq_fardighet_text}</code>, <code>{tq_motivation_text}</code>,
                <code>{leda_text}</code>, <code>{mod_text}</code>,
                <code>{sjalkannedom_text}</code>, <code>{strategi_text}</code>,
                <code>{kommunikation_text}</code> ‚Äì texter som genererats i tidigare steg.<br>

                <code>{sur_text}</code> ‚Äì listan med styrkor/utvecklingsomr√•den/riskbeteenden.
                <br><br>

                <b>Viktigt:</b> Ta inte bort taggarna i klamrar om du vill att r√§tt information ska
                f√∂ras in automatiskt.
              </div>

              <form method="post">
                {% csrf_token %}

                {# ===== SEKTION 1: Excelfil ‚Äì teknisk struktur ===== #}
                {% for prompt in prompts %}
                  {% if prompt.name == "tolka_excel_resultat" %}
                    <div class="adminui-container" style="margin-bottom:32px;">
                      <h3 class="adminui-subtitle">1. Tolkning av Excelfil (teknisk struktur)</h3>
                      <p class="adminui-help" style="font-size:0.9rem;">
                        Denna prompt beskriver hur Excelfilen √§r <b>uppbyggd</b> och vad varje
                        kolumn betyder. I nuvarande version anv√§nds tolkningen i f√∂rsta hand i
                        programmets Python-kod, men texten kan ligga kvar h√§r som dokumentation.
                        <br><br>
                        <span style="color: red;">√Ñndra endast om Excelformat eller kolumnnamn √§ndras.</span>
                      </p>
                      <textarea
                        name="prompt_{{ prompt.name }}"
                        rows="8"
                        class="adminui-textarea"
                      >{{ prompt.text }}</textarea>
                    </div>
                  {% endif %}
                {% endfor %}

                {# ===== SEKTION 2: Betygsskala ‚Äì betydelsen av niv√•erna ===== #}
                {% for prompt in prompts %}
                  {% if prompt.name == "betygsskala_forklaring" %}
                    <div class="adminui-container" style="margin-bottom:32px;">
                      <h3 class="adminui-subtitle">2. Betygsskala: Vad betyder niv√•erna 1‚Äì5?</h3>
                      <p class="adminui-help" style="font-size:0.9rem;">
                        Denna prompt anv√§nds i alla bed√∂mningssteg. H√§r beskriver du hur AI:n ska
                        tolka po√§ng p√• skalan 1‚Äì5, b√•de generellt och (valfritt) specifikt f√∂r
                        varje kompetens. Detta s√§kerst√§ller konsekvent tolkning i rapporterna.
                        <br><br>
                        <b>Rekommendation:</b> Beskriv b√•de en generell skala samt
                        per-kompetens-exempel om du vill ha √§nnu mer styrning.
                      </p>
                      <textarea
                        name="prompt_{{ prompt.name }}"
                        rows="12"
                        class="adminui-textarea"
                      >{{ prompt.text }}</textarea>
                    </div>
                  {% endif %}
                {% endfor %}

                {# ===== SEKTION 3: √ñvriga prompts ‚Äì analyser & slutsatser ===== #}
                <div class="adminui-container" style="margin-bottom:16px;">
                  <h3 class="adminui-subtitle">3. √ñvriga prompts (analyser och slutsatser)</h3>
                  <p class="adminui-help" style="font-size:0.9rem; margin-bottom:16px;">
                    Dessa prompts styr hur AI:n formulerar analyserna baserat p√• testdata,
                    intervjuanteckningar, betyg och dina skaldefinitioner.
                    <br>
                    Anpassa ton, l√§ngd och detaljer efter vad du vill att Julia AI ska ge f√∂r typ av output.
                  </p>

                  {% for prompt in prompts %}
                    {% if prompt.name not in "tolka_excel_resultat betygsskala_forklaring" %}
                      <div style="margin-bottom:24px;">
                        <label for="prompt_{{ prompt.name }}" class="adminui-label">
                          {{ prompt.name|capfirst }}
                        </label>
                        <p style="font-size:0.8rem; color:#666; margin-bottom:4px;">
                          Beh√•ll relevanta taggar (t.ex.
                          <code>{intervju_text}</code>,
                          <code>{ratings_json}</code>,
                          <code>{betygsskala_forklaring}</code>).
                        </p>
                        <textarea
                          id="prompt_{{ prompt.name }}"
                          name="prompt_{{ prompt.name }}"
                          rows="6"
                          class="adminui-textarea"
                        >{{ prompt.text }}</textarea>
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>

                <button type="submit" class="adminui-button">
                  üíæ Spara √§ndringar
                </button>
              </form>

            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- H√ñGERSPALT / PLATS F√ñR INFO -->
    <aside class="right-panel">
      <div class="right-panel-card">
        <h3 class="assistant-title">Tips f√∂r prompts</h3>
        <p class="assistant-empty">
          H√•ll en konsekvent ton, beh√•ll taggarna i klamrar och testa √§ndringar i verktyget
          efter att du sparat.
        </p>
      </div>
    </aside>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/script.js' %}"></script>
</body>
</html>
