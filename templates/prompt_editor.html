{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Julia</title>

    <!-- Bootstrap CSS (samma som p√• verktygssidan) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Din egna styles -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" href="{% static 'img/favicon.ico' %}">
</head>

<body id="page-top">
  <div class="app-shell">

    <!-- SIDEBAR (samma som p√• verktygssidan, men med aktiv l√§nk p√• √Ñndra prompts) -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <span class="brand-dot"></span>
        <span class="brand-text">Julia AI</span>
      </div>

      <nav class="sidebar-nav">
        <a href="{% url 'index' %}" class="sidebar-link">
          <span class="sidebar-icon">‚öôÔ∏è</span>
          <span>Verktyget</span>
        </a>
        <a href="{% url 'prompt_editor' %}" class="sidebar-link sidebar-link-active">
          <span class="sidebar-icon">üìù</span>
          <span>√Ñndra prompts</span>
        </a>
        <a href="{% url 'chat_home' %}" class="sidebar-link">
          <span class="sidebar-icon">üí¨</span>
          <span>Chatt</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-chip">
          <div class="user-avatar">
            {{ user.first_name|default:"J" |first }}
          </div>
          <div class="user-meta">
            <span>Inloggad som</span>
            <strong>{{ user.get_full_name|default:"G√§st" }}</strong>
          </div>
        </div>
        <button class="logout-btn" type="button">
          Logga ut
        </button>
        <p class="sidebar-copy">¬© TQ Nordic</p>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-area">
      <header class="page-header">
        <div>
          <h1>Hej {{ user.first_name|default:user.username }} üëã</h1>
          <p>Uppdatera AI-instruktioner f√∂r Domarn√§mnden.</p>
        </div>
        <div class="page-header-meta">
          <span class="pill">Domarn√§mnden</span>
          <span class="pill pill-soft">Prompts</span>
        </div>
      </header>

      <section id="about">
        <div class="adminui-layout">
          <div class="adminui-main">
            <div class="adminui-container">

              <h2 class="adminui-title" style="margin-top:0;">Redigera AI-instruktioner</h2>
              <p class="adminui-intro">
                H√§r styr du hur Julia AI tolkar testresultat, intervjuanteckningar och hur
                rapportens olika delar formuleras. Uppdelat i tre tydliga sektioner.
              </p>

              <form method="post">
                {% csrf_token %}

                {# ===== SEKTION 1: Excelfil ‚Äì teknisk struktur ===== #}
                {% for prompt in prompts %}
                  {% if prompt.name == "tolka_excel_resultat" %}
                    <div class="adminui-container" style="margin-bottom:32px;">
                      <h3 class="adminui-subtitle">1. Tolkning av Excelfil (teknisk struktur)</h3>
                      <p class="adminui-help" style="font-size:0.9rem;">
                        Denna prompt beskriver hur Excelfilen √§r <b>uppbyggd</b> och vad varje
                        kolumn betyder. I nuvarande version anv√§nds tolkningen i f√∂rsta hand i
                        programmets Python-kod, men texten kan ligga kvar h√§r som dokumentation.
                        <br><br>
                        <span style="color: red;">√Ñndra endast om Excelformat eller kolumnnamn √§ndras.</span>
                      </p>
                      <textarea
                        name="prompt_{{ prompt.name }}"
                        rows="8"
                        class="adminui-textarea"
                      >{{ prompt.text }}</textarea>
                    </div>
                  {% endif %}
                {% endfor %}

                {# ===== SEKTION 2: Betygsskala ‚Äì betydelsen av niv√•erna ===== #}
                {% for prompt in prompts %}
                  {% if prompt.name == "betygsskala_forklaring" %}
                    <div class="adminui-container" style="margin-bottom:32px;">
                      <h3 class="adminui-subtitle">2. Betygsskala: Vad betyder niv√•erna 1‚Äì5?</h3>
                      <p class="adminui-help" style="font-size:0.9rem;">
                        Denna prompt anv√§nds i alla bed√∂mningssteg. H√§r beskriver du hur AI:n ska
                        tolka po√§ng p√• skalan 1‚Äì5, b√•de generellt och (valfritt) specifikt f√∂r
                        varje kompetens. Detta s√§kerst√§ller konsekvent tolkning i rapporterna.
                        <br><br>
                        <b>Rekommendation:</b> Beskriv b√•de en generell skala samt
                        per-kompetens-exempel om du vill ha √§nnu mer styrning.
                      </p>
                      <textarea
                        name="prompt_{{ prompt.name }}"
                        rows="12"
                        class="adminui-textarea"
                      >{{ prompt.text }}</textarea>
                    </div>
                  {% endif %}
                {% endfor %}

                {# ===== SEKTION 3: √ñvriga prompts ‚Äì analyser & slutsatser ===== #}
                <div class="adminui-container" style="margin-bottom:16px;">
                  <h3 class="adminui-subtitle">3. √ñvriga prompts (analyser och slutsatser)</h3>
                  <p class="adminui-help" style="font-size:0.9rem; margin-bottom:16px;">
                    Dessa prompts styr hur AI:n formulerar analyserna baserat p√• testdata,
                    intervjuanteckningar, betyg och dina skaldefinitioner.
                    <br>
                    Anpassa ton, l√§ngd och detaljer efter vad du vill att Julia AI ska ge f√∂r typ av output.
                  </p>

                  {% for prompt in prompts %}
                    {% if prompt.name not in "tolka_excel_resultat betygsskala_forklaring" %}
                      <div style="margin-bottom:24px;">
                        <label for="prompt_{{ prompt.name }}" class="adminui-label">
                          {{ prompt.name|capfirst }}
                        </label>
                        <p style="font-size:0.8rem; color:#666; margin-bottom:4px;">
                          Beh√•ll relevanta taggar (t.ex.
                          <code>{intervju_text}</code>,
                          <code>{ratings_json}</code>,
                          <code>{betygsskala_forklaring}</code>).
                        </p>
                        <textarea
                          id="prompt_{{ prompt.name }}"
                          name="prompt_{{ prompt.name }}"
                          rows="6"
                          class="adminui-textarea"
                        >{{ prompt.text }}</textarea>
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>

                <button type="submit" class="adminui-button">
                  üíæ Spara √§ndringar
                </button>
              </form>

            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- H√ñGERSPALT -->
    <aside class="right-panel">
        <h3 class="assistant-title">Tillg√§ngliga taggar</h3>
        <p class="assistant-help">
          Klistra in dessa i dina prompts d√§r du vill att data ska ers√§ttas automatiskt.
        </p>

  <h3 class="assistant-title">Grunddata</h3>

<div class="tag-box">
  <div class="tag-box-left">
    <code>{excel_text}</code>
    <p>R√•data fr√•n Excel</p>
  </div>

  <button class="tag-example-btn" data-modal="modal-excel">
    Se exempel
  </button>
</div>

  <div class="tag-box">
    <code>{intervju_text}</code>
    <p>Intervjuanteckningar</p>
  </div>

  <div class="tag-box">
    <code>{ratings_json}</code>
    <p>Betyg 1‚Äì5</p>
  </div>

  <div class="tag-box">
    <code>{betygsskala_forklaring}</code>
    <p>Definition av niv√•erna</p>
  </div>

        <div class="assistant-section">
          <h4 class="assistant-section-title">Tidigare texter</h4>
          <p class="assistant-help" style="margin-bottom:0.5rem;">
            TQ-texter som genereras i andra steg och kan √•teranv√§ndas h√§r:
          </p>
          <ul class="assistant-list">
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{tq_fardighet_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{tq_motivation_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{leda_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{mod_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{sjalkannedom_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{strategi_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{kommunikation_text}</code></span>
            </li>
            <li class="assistant-list-item">
              <span class="assistant-label"><code>{sur_text}</code></span>
              <span class="assistant-value">Styrkor / Utvecklingsomr√•den / Riskbeteenden.</span>
            </li>
          </ul>
        </div>

        <p class="assistant-empty" style="margin-top:1rem;">
          Ta inte bort taggarna i klamrar om du vill att r√§tt info ska fyllas i automatiskt.
        </p>
    </aside>

  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/script.js' %}"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
  
  // √ñppna popup
  document.querySelectorAll(".tag-example-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const modalId = btn.dataset.modal;
      document.getElementById(modalId).classList.add("is-open");
    });
  });

  // St√§ng popup (alla st√§ng-knappar)
  document.querySelectorAll(".dn-modal-close").forEach(btn => {
    btn.addEventListener("click", () => {
      btn.closest(".dn-modal").classList.remove("is-open");
    });
  });

  // St√§ng popup genom att klicka p√• m√∂rka bakgrunden
  document.querySelectorAll(".dn-modal").forEach(modal => {
    modal.addEventListener("click", e => {
      if (e.target.classList.contains("dn-modal-backdrop")) {
        modal.classList.remove("is-open");
      }
    });
  });

});
  </script>

  <!-- ===== Popup: Excel ===== -->
<div id="modal-excel" class="dn-modal">
  <div class="dn-modal-backdrop"></div>
  <div class="dn-modal-content">
    <button type="button" class="dn-modal-close">√ó</button>
    <h3>Exempel: {excel_text}</h3>
    <div class="dn-modal-body">
      <pre>
Kolumn A: Kompetens
Kolumn B: Po√§ng (1‚Äì10)
Kolumn C: F√§rgade rutor
...
      </pre>
    </div>
  </div>
</div>

<!-- ===== Popup: Intervju ===== -->
<div id="modal-intervju" class="dn-modal">
  <div class="dn-modal-backdrop"></div>
  <div class="dn-modal-content">
    <button type="button" class="dn-modal-close">√ó</button>
    <h3>Exempel: {intervju_text}</h3>
    <div class="dn-modal-body">
      <pre>
Kandidaten beskriver sig som driven och strukturerad.
Har lett tv√• team och ansvarat f√∂r onboarding.
Styrkor: analys, kommunikation.
Utmaningar: tidspress och snabba deadlines.
      </pre>
    </div>
  </div>
</div>

<!-- ===== Popup: Ratings JSON ===== -->
<div id="modal-ratings" class="dn-modal">
  <div class="dn-modal-backdrop"></div>
  <div class="dn-modal-content">
    <button type="button" class="dn-modal-close">√ó</button>
    <h3>Exempel: {ratings_json}</h3>
    <div class="dn-modal-body">
      <pre>
{
  "Planning & Organising": 4,
  "Resilience": 3,
  "Analysis": 5,
  "Collaboration": 4
}
      </pre>
    </div>
  </div>
</div>

<!-- ===== Popup: Betygsskala ===== -->
<div id="modal-betygsskala" class="dn-modal">
  <div class="dn-modal-backdrop"></div>
  <div class="dn-modal-content">
    <button type="button" class="dn-modal-close">√ó</button>
    <h3>Exempel: {betygsskala_forklaring}</h3>
    <div class="dn-modal-body">
      <pre>
1 = Begr√§nsad niv√•, kr√§ver n√§ra st√∂d.
2 = Tillr√§cklig niv√• i enklare situationer.
3 = God niv√• i de flesta situationer.
4 = Mycket god niv√•, visar konsekvent styrka.
5 = Exceptionell niv√•, f√∂rebildligt beteende.
      </pre>
    </div>
  </div>
</div>

</body>
</html>
